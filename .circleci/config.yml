# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  say-hello:
    # Specify the execution environment. You can specify an image from Dockerhub or use one of our Convenience Images from CircleCI's Developer Hub.
    # See: https://circleci.com/docs/2.0/configuration-reference/#docker-machine-macos-windows-executor
    docker:
      - image: cimg/base:stable
    # Add steps to the job
    # See: https://circleci.com/docs/2.0/configuration-reference/#steps
    steps:
      - checkout
      - run:
          name: "Say hello"
          command: "echo Hello, World!"
      - run: 
          name: curl test verbose
          command: |
            curl --request POST \
            --url ${COMPASS_WEBTRIGGER_URL} \
            --header "Accept: application/json" \
            --header "Content-Type: application/json" \
            --data "{\"description\":\"${CIRCLE_PROJECT_REPONAME} #${CIRCLE_BUILD_NUM} ${CIRCLE_JOB}\",
              \"buildNumber\": \"${CIRCLE_BUILD_NUM}\",
              \"status\":\"IN_PROGRESS\",
              \"workflowId\":\"${CIRCLE_WORKFLOW_ID}\",
              \"workspaceId\":\"${CIRCLE_WORKFLOW_WORKSPACE_ID}\",
              \"repoUrl\":\"${CIRCLE_REPOSITORY_URL}\",
              \"repoName\":\"${CIRCLE_PROJECT_REPONAME}\",
              \"externalSourceId\":\"${EXTERNAL_SOURCE_ID}\"
              }"
            echo "successful curl to webtrigger"
            
      
# curl --request POST \
#             --url https://yoda100.atlassian.net/gateway/api/compass/v1/metrics \
#             --user ${COMPASS_USER_EMAIL}:${COMPASS_API_KEY} \
#             --header "Accept: application/json" \
#             --header "Content-Type: application/json" \
#             --data "{\"metricSourceId\": \"ari:cloud:compass:9ca8edb0-ccd1-420c-a3e6-7ee494baa7a3:metric-source/e7552028-cb74-424c-9947-f97c53355bdc/4be3d267-6563-4e5f-902b-5d08bfc1a743\",
#               \"value\": 100,
#               \"timestamp\": 
#               \"$(date -u +'%Y-%m-%dT%H:%M:%SZ')\"
#               }" 
# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  say-hello-workflow:
    jobs:
      - say-hello
